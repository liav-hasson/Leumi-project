* draft document

A big issue i encounter when working with terraform and kubernetes, is the management of multiple API sources, and resource responsibilty.

the general rules i try to follow are these:
- let terraform create all infrastructure.
- let kubernets configure clusters using gitops.
- use the least amount of scripting, terraform data / local exec blocks.

that is good in theory, but once accutally creating resources in prcatice, several issues happen, and you must bridge the gap between terraform - kubernetes API. 
some questions i ask myself:

- who controls the cluster load balancers? 
- how do we pass data from one to another?
- how to avoid "chicken and egg situations"?
- where is the line drawn between terrafrom and kubernetes?

example case: creating a load balancer for a kubernetes service:

1. terraform API case: 

    the load balancer, lets say an ALB, is created before kubernetes configuration. 
    it makes it easy to link it to other terrafrom resources, such as route53.

    but it leads to the question: how do we let kubernetes resources actually use that ALB?
    
        a. TargetGroupBinding (chosen approach)

            - TGB is a CRD, provided by the AWS load balancer controller.
            - it lets terraform create the ALB itself, and allows kubernetes to manage the backend targets, dynamically.
            - it is a good, simple solution. only downside: not the most gitops friendly.
            - forces you to deal with finalizers when destroying infra, since the target groups are in terraform, not by the kubernetes controller.
        
        b. tag matching:
            
            - when matching ALB labels between terraform and argocd, the load balancer controller can see that the ALB already exist, and wont create another one. 
            - trying to "trick" the ALB load balancer controller to think it created the ALB.
            - i dont recommend, unstable and can lead to many issues that requires manual patching (for example, default security groups mismatch)

        c. 
            

2. kubernets API case: 

    letting the cloud load balancer controller to create the ALB after terraform finishes makes it easy to link the load balancer to cluster resources, but leads to problems:

    how do i get route53 to be attached to the ALB?

        a. terraform data sources

            for example, when wanting to give the ALB a route53 domain that is created in terraform.
            we can use a data source to wait for the kubernetes controller to finish creating the ALB.
            the big downside is complex timing management for the data block execution.

        b. external-dns kubernetes controller

            gitops heavy, but a proper solution.

        c. 