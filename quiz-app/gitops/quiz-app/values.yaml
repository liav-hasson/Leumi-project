# =============================================================================
# DevOps Quiz Application - Helm Values
# =============================================================================
# Configuration for Flask-based quiz application with OpenAI integration
# Deployed via Jenkins pipeline â†’ ArgoCD GitOps

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
app:
  name: quiz-app
  replicaCount: 3
  
  image:
    repository: liavvv/quiz-app
    pullPolicy: IfNotPresent
    tag: "latest"  # Will be overridden by Jenkins pipeline
  
  # Service configuration
  service:
    type: ClusterIP
    port: 5000
    targetPort: 5000
  
  # Environment variables
  # Note: OPENAI_API_KEY is injected from External Secrets (see deployment.yaml)
  env:
    - name: FLASK_ENV
      value: "production"
    - name: PYTHONUNBUFFERED
      value: "1"

# =============================================================================
# KUBERNETES RESOURCES
# =============================================================================
# Global settings
nameOverride: ""
fullnameOverride: "quiz-app"

# Service Account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# Ingress for external access
ingress:
  enabled: true
  # Production uses AWS Load Balancer Controller (ALB)
  className: "alb"  # Static: AWS Load Balancer Controller
  annotations:
    kubernetes.io/ingress.class: "alb"
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80},{"HTTPS":443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'  # Redirect HTTP to HTTPS
    alb.ingress.kubernetes.io/healthcheck-path: "/"
    # Certificate ARN created by Terraform (route53 module with DNS validation)
    # After terraform apply, update this with: terraform output acm_certificate_arn
    alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:eu-north-1:ACCOUNT_ID:certificate/CERT_ID"
    alb.ingress.kubernetes.io/group.name: "quiz-weatherlabs"
  hosts:
    - host: "quiz.weatherlabs.org"
      paths:
        - path: /
          pathType: Prefix
          servicePort: 5000

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Health checks
probes:
  liveness:
    httpGet:
      path: /
      port: 5000
    initialDelaySeconds: 30
    periodSeconds: 10
  readiness:
    httpGet:
      path: /
      port: 5000
    initialDelaySeconds: 5
    periodSeconds: 5

# =============================================================================
# EXTERNAL SECRETS CONFIGURATION
# =============================================================================
# Syncs OpenAI API key from AWS SSM Parameter Store
externalSecrets:
  enabled: true
  secretStore:
    name: aws-parameter-store
    provider: aws
    region: eu-north-1
  secrets:
    - name: openai-api-key
      target: quiz-app-secrets
      key: /devops-quiz/openai-api-key
      property: OPENAI_API_KEY

# =============================================================================
# OPTIONAL CONFIGURATIONS
# =============================================================================
autoscaling:
  enabled: false

# Pod configuration
podAnnotations: {}
podLabels: {}
podSecurityContext: {}
securityContext: {}

# Node scheduling
nodeSelector: {}
tolerations: []
affinity: {}
