Answering debugging questions based on the diagram (reference.png)

1. a. The TEST EC2 machine is unable to resolve DNS of Internet addresses

    - i would start by understanding the situation as best as possible, then apply a structured debugging flow following the data flow. 

    - to get a good understanding, i would ask:
        is it only that ec2? 
        what about other machines in the subnet? 
        is it only to a specific destination?
        what about internal DNS?
        what recent changes were made?
        are there known external third party issues?

    - The DNS process happens in multiple points. this are some potential failure points: 
        - kubernetes level - core-dns pods
        - instance level - /etc/resolv.conf
        - VPC level - every VPC has a DNS resolver.  

    - after verifying the environment, i would start debugging using linux commands (dig, nslookup, netstat, ping etc..), AWS CLI commands and logs/events (AWS cloudwatch). i would debug in these stages:
    - checking firewalls - security groups or NACL configurations.
    - check VPC configurations - IGW, Route tables, NAT.
    - check instance level DNS - /etc/resolv.conf
    - If using, check Load Balancers health, and that target groups ports are matching.
    - chek the status of the transit gateway, verify traffic reaches to egress VPC.
    - check ispection VPC anf firewalls, looking at recent logs.

---

1. b. The TEST EC2 machine receives DNS address translation but fails to communicate to the Internet

    - in this case, DNS works but there is no internet connectivity. this means the issue is in the routing/gateway layer.

    - like before, i would test the following failure points:

    - Check if subnet has correct default route:
        - Public subnet needs: '0.0.0.0/0 → igw-xxxxx'
        - Private subnet needs: '0.0.0.0/0 → nat-xxxxx'

    - Check if subnet has proper route table association.
    - Check NAT gateway / instance status.
    - Check egress rules allow '0.0.0.0/0' on all protocols
    - chek the status of the transit gateway, verify traffic reaches to egress VPC.
    - check ispection VPC anf firewalls, looking at recent logs and metrics from AWS cloudwatch.

---

1. c. The TEST EC2 machine has a docker engine installed, its repo is in the vpc alm in the nexus repo machine

Context: Docker connects to Nexus repository in VPC ALM for image pulls

    i. Error 1: pull access denied

        this error is an authentication/authorization problem with the Nexus registry.

        potential failure points:

        1. Docker Not Authenticated to Nexus
        - Docker client not logged into Nexus registry 
        - Credentials might be wrong or expired (~/.docker/config.json` for auth tokens)

        2. Docker Not authorized for the action
        - User/service account lacks pull permissions on repository
        - Nexus realm authentication not configured (Docker Bearer Token Realm)
        - Check Nexus UI security configurations.


        3. docker / nexus misconfigurations
        - Image name doesn't match Nexus repository name
        - Docker proxy/hosted repository not set up correctly
        - HTTP vs HTTPS port mismatch

    ---

    ii. Error 2: container pull timeout

        networking issue between TEST EC2 and Nexus in VPC ALM.

        potential failure points:

        1. Routing Between VPCs
        - Check if VPC peering or Transit Gateway configured
        - Verify route tables have route to VPC ALM CIDR
        - Test by pinging the nexus machine from the TEST EC2
        - check DNS resolution if using a private hosted zone

        2. Security Group Rules / NACL
        - Nexus security group must allow inbound from TEST EC2
        - Check both SGs allow required ports

        3. application issues
        - Nexus service down or starting
        - Default Docker timeout too short for slow networks

    ---

    iii. Error 3: docker daemon is not running

        Docker service issue on TEST EC2 machine.

        potential failure points:

        1. Docker Service Not Started, stpped or failed
        - Check: 'systemctl status docker'
        - View errors: 'journalctl -u docker'

        2. Docker Not Installed
        - Check: 'which docker' and 'docker --version'
        - Disk full or filesystem issues


        3. Docker Socket Permissions
        - Socket '/var/run/docker.sock' missing or has wrong permissions
        - User is not in 'docker' group

---

2. Externalizing a service to the Internet based on a DNS record and a reference to the test ec2 machine, with external access you receive the public address of the machine but are unable to browse the service on https

    - in this case, DNS resolution works (you can reach the public IP), but HTTPS connection fails. this means the issue is in the service/network layer.

    - i would approach this systematically, testing each layer of the HTTPS connection:

    1. Service Not Running / Not Listening on HTTPS Port
    - Web server (Apache, Nginx, etc.) might be stopped, verify, for example: 'systemctl status httpd' or 'systemctl status nginx'
    - Check if service is listening on the port: 'netstat -tulpn | grep :443'
    - If service is containerized, check docker compose configuration.

    2. Security Group Rules / NACL
    - security group doesn't allow inbound HTTPS (port 443)
    - Network ACL might block port 443 at subnet level, check both inbound and outbound rules. (and allow ephemeral ports)

    3. SSL/TLS Certificate Issues
    - Certificate expired or not installed
    - browser rejects self-signed certificate
    - Certificate doesn't match domain name
    - check private and public key match, and that the server (or load balancer) have the certificates

    4. Route53 / Load balancer
    - DNS might point to wrong IP address
    - ALB/NLB listener not configured for port 443
    - Target group health checks failing

    debugging commands to try:
        (by replicating the environment or connecting to the machine)

        - direct IP test: 'curl -v https://<public-ip>'
        - DNS test: 'curl -v https://<domain>' 
        - check if port is open: 'telnet <public-ip> 443'
        - Listening ports: 'ss -tulpn | grep 443'
        - Certificate: 'ls -la /etc/ssl/certs/'
        - Firewall: 'iptables -L -n | grep 443'

---

3. When trying to telnet from the test ec2 machine, an error is received that this software is missing. How would you install it on amazon linux 2? What could be causing its installation failure from the repo and what command would you use to resolve this?

    - telnet is not installed by default on Amazon Linux 2 for security reasons (unencrypted protocol). install it first using the 'yum' package manager.

    potential failure points during installation:

    1. EC2 issues:
    - No internet connectivity in the EC2, debug network issues from before.
    - No space left for package download/installation, check: 'df -h'

    2. Yum Metadata Corrupted / Outdated
    - Yum cache is stale or corrupted
    - Repository metadata hasn't been updated
    - Repo files missing or misconfigured

    troubleshooting commands:

    1. Clean and rebuild yum cache:
        'sudo yum clean all'
        'sudo yum makecache'

    2. Update yum metadata:
        'sudo yum update -y'

    3. Check available packages:
        'yum list available | grep telnet'

    4. Check repository configuration:
        'yum repolist'
        'cat /etc/yum.repos.d/amzn2-core.repo'

    5. Test repository connectivity:
        'curl -I https://cdn.amazonlinux.com/2/core/latest/x86_64/'

    6. Verbose installation to see exact error:
        'sudo yum install telnet -v'